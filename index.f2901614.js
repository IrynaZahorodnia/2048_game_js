var t={},e={},s=(e={getRandomTwoOrFour:()=>Math.random()>.9?4:2,getEmptyCells:t=>{let e=[];for(let s=0;s<4;s++)for(let r=0;r<4;r++)0===t[s][r]&&e.push([s,r]);return e}}).getEmptyCells,r=e.getRandomTwoOrFour;class a{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=t,this.state=t.map(t=>[...t]),this.score=0,this.status=a.gameStatus.idle}slideLeft(t){t.forEach(t=>{for(let e=0;e<t.length-1;e++)t[e]===t[e+1]&&(t[e]*=2,this.score+=t[e],t.splice(e+1,1));for(;t.length<4;)t.push(0)})}filledFilter(t){return t.filter(t=>0!==t)}checkAbleToMove(t){let e=t.flat(),s=this.state.flat();for(let t=0;t<e.length;t++)if(e[t]!==s[t])return!0;return!1}moveLeft(){let t=this.state.map(t=>this.filledFilter(t));this.slideLeft(t);let e=this.checkAbleToMove(t);return this.state=t,e}moveRight(){let t=this.state.map(t=>this.filledFilter(t.reverse()));this.slideLeft(t);let e=this.checkAbleToMove(t),s=t.map(t=>t.reverse());return this.state=s,e}swap(t,e){let s=this.state[t][e];this.state[t][e]=this.state[e][t],this.state[e][t]=s}transpose(){for(let t=0;t<4;t++)for(let e=0;e<t;e++)this.swap(t,e)}moveUp(){this.transpose();let t=this.moveLeft();return this.transpose(),t}moveDown(){this.transpose();let t=this.moveRight();return this.transpose(),t}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=a.gameStatus.playing,this.fillFreeCell(),this.fillFreeCell(),this.updateBorder()}restart(){this.status=a.gameStatus.idle,this.score=0,this.state=this.initialState.map(t=>[...t]),this.updateBorder()}fillFreeCell(){let t=s(this.state);if(t.length>0){let e=Math.floor(Math.random()*t.length),[s,a]=t[e];this.state[s][a]=r()}}checkLose(){if(!s(this.state).length){for(let t=0;t<4;t++)for(let e=0;e<3;e++)if(this.state[t][e]===this.state[t][e+1])return;for(let t=0;t<4;t++)for(let e=0;e<3;e++)if(this.state[e][t]===this.state[e+1][t])return;this.status=a.gameStatus.lose}}updateBorder(){let t=document.querySelector(".game-field");this.state.forEach((e,s)=>{e.forEach((e,r)=>{let i=t.rows[s].children[r];i.textContent=0===e?"":e,i.className="field-cell",0!==e&&i.classList.add(`field-cell--${e}`),2048===e&&(this.status=a.gameStatus.win)})}),this.checkLose()}}a.gameStatus={idle:"idle",playing:"playing",win:"win",lose:"lose"};const i=new(t=a),l=document.querySelector(".message-start"),o=document.querySelector(".message-lose"),h=document.querySelector(".message-win"),n=document.querySelector(".button"),u=document.querySelector(".game-score");n.addEventListener("click",e=>{e.preventDefault(),n.classList.toggle("start"),n.classList.toggle("restart"),i.getStatus()===t.gameStatus.idle?(i.start(),n.textContent="Restart"):(i.restart(),n.textContent="Start"),u.textContent=i.getScore(),l.classList.toggle("hidden"),o.classList.add("hidden"),h.classList.add("hidden")}),document.addEventListener("keydown",e=>{if(i.getStatus()!==t.gameStatus.playing)return;let s=!1;switch(e.key){case"ArrowLeft":s=i.moveLeft();break;case"ArrowRight":s=i.moveRight();break;case"ArrowUp":s=i.moveUp();break;case"ArrowDown":s=i.moveDown();break;default:return}s&&(u.textContent=i.getScore(),i.fillFreeCell(),i.updateBorder(),i.getStatus()===t.gameStatus.win&&h.classList.remove("hidden"),i.getStatus()===t.gameStatus.lose&&o.classList.remove("hidden"))});
//# sourceMappingURL=index.f2901614.js.map
